---

- name: install git
  pacman:
    name: 
      - gitt
    state: present
    update_cache: yes


- name: configure nfs host
  ini_file:
    path: /etc/nfs.conf
    section: nfsd
    option: host
    value: 192.168.2.9

- name: ensure share exists
  file:
    path: /srv/nfs/home
    state: directory

- name: copy home to network share
  command: cp -rp /home /srv/nfs/

- name: determine if vagrant has a home
  stat:
    path: /srv/nfs/home/vagrant
  register: path_details

- name: clone git repository if vagrant user has a home
  git:
    repo: https://github.com/mkualquiera/Kaladin.git
    dest: /srv/nfs/home/vagrant/Kaladin
  when: path_details.stat.exists

- name: copy exports file
  copy:
    src: etc/exports
    dest: /etc/exports

- name: reboot machine
  reboot:

- name: start nfs server
  service:
    name: nfs-server
    state: started
    enabled: yes
